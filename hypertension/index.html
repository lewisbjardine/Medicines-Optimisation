<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Hypertension – medication picker</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="../shared/styles.css">
<style>
main{max-width:1100px;margin:1.2rem auto;padding:1rem;background:#fff;border-radius:6px;box-shadow:0 2px 6px rgba(0,0,0,.1)}
.small{font-size:.85rem}
.section{margin-top:1.2rem}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:1rem}
.matrix{border:1px solid var(--nhs-border);border-radius:4px;overflow:hidden}
.row{display:grid;grid-template-columns:180px 1fr 110px;gap:.4rem;padding:.45rem;border-bottom:1px solid #eee;align-items:center;font-size:.8rem}
.row:last-child{border-bottom:none}
.doses{display:flex;flex-wrap:wrap;gap:.3rem}
.dose{display:flex;align-items:center;gap:.2rem;padding:.1rem .35rem;border-radius:4px;border:1px solid var(--nhs-border);cursor:pointer}
.dose.current{background:#e8f4ff;border-color:#0072ce;font-weight:bold}
.dose.blocked{opacity:.4;text-decoration:line-through}
.block-dose{font-size:.75rem;color:#d4351c;cursor:pointer}
.block-btn{font-size:.7rem}
</style>
</head>
<body>

<header>
<h1>Hypertension management assistant</h1>
<p class="subtitle">Structured antihypertensive review</p>
<a href="../index.html" class="return-home">Back to home</a>
</header>

<main>

<section class="card small">
<h2>1. Patient factors</h2>
<div class="grid">
  <div>
    <label>Age band</label>
    <select id="age">
      <option>&lt;55</option>
      <option selected>55–79</option>
      <option>≥80</option>
    </select>
  </div>
  <div>
    <label>Ethnicity</label>
    <select>
      <option>White / Other</option>
      <option>Black African or Caribbean</option>
    </select>
  </div>
  <div>
    <label>Key risk factors</label>
    <select multiple size="4">
      <option>Diabetes</option>
      <option>CKD</option>
      <option>Proteinuria</option>
      <option>Ischaemic heart disease</option>
    </select>
    <div class="hint">Hold Ctrl / Cmd to select multiple</div>
  </div>
</div>
</section>

<section class="card section small">
<h2>2. Current antihypertensive treatment</h2>

<div class="grid-2">

<div>
<h3>A – ACE inhibitors / ARBs</h3>
<div class="matrix" id="A"></div>
</div>

<div>
<h3>C – Calcium-channel blockers</h3>
<div class="matrix" id="C"></div>
</div>

<div>
<h3>D – Thiazide-like diuretics</h3>
<div class="matrix" id="D"></div>
</div>

<div>
<h3>Other / Step 4</h3>
<div class="matrix" id="O"></div>
</div>

</div>
</section>

<section class="card section small">
<h2>3. Blood pressure</h2>
<div class="grid">
  <div>
    <label>Measurement</label>
    <select>
      <option>Clinic</option>
      <option>Home / ABPM</option>
    </select>
  </div>
  <div>
    <label>BP</label>
    <input placeholder="e.g. 152/94">
  </div>
</div>
</section>

<section class="card section small">
<h2>4. Plan</h2>
<button class="small">Generate plan (preview)</button>
<div class="output-box">Preview only – NICE logic to be reattached</div>
</section>

</main>

<script>
const DRUGS={
 A:[
  {n:"Ramipril",d:["1.25","2.5","5","10"]},
  {n:"Lisinopril",d:["2.5","5","10","20","40"]},
  {n:"Losartan",d:["25","50","100"]},
  {n:"Candesartan",d:["2","4","8","16","32"]}
 ],
 C:[
  {n:"Amlodipine",d:["2.5","5","10"]},
  {n:"Felodipine MR",d:["2.5","5","10"]},
  {n:"Lercanidipine",d:["10","20"]}
 ],
 D:[
  {n:"Indapamide MR",d:["1.5"]},
  {n:"Chlortalidone",d:["12.5","25"]}
 ],
 O:[
  {n:"Spironolactone",d:["12.5","25"]},
  {n:"Doxazosin MR",d:["4","8"]},
  {n:"Bisoprolol",d:["1.25","2.5","5","10"]}
 ]
};

const state={};

function renderSection(key){
 const box=document.getElementById(key);
 box.innerHTML="";
 DRUGS[key].forEach(drug=>{
  if(!state[drug.n]) state[drug.n]={c:null,b:new Set(),bd:false};
  const s=state[drug.n];
  const row=document.createElement("div");
  row.className="row";

  const name=document.createElement("strong");
  name.textContent=drug.n;

  const doses=document.createElement("div");
  doses.className="doses";

  drug.d.forEach(x=>{
   const d=document.createElement("div");
   d.className="dose";
   if(s.c===x) d.classList.add("current");
   if(s.b.has(x)) d.classList.add("blocked");
   d.textContent=x+" mg";
   d.onclick=()=>{
    if(s.b.has(x)) return;
    s.c=(s.c===x)?null:x;
    renderAll();
   };
   const blk=document.createElement("span");
   blk.className="block-dose";
   blk.textContent="⛔";
   blk.onclick=e=>{
    e.stopPropagation();
    if(s.b.has(x)) s.b.delete(x);
    else{
     s.b.add(x);
     if(s.c===x) s.c=null;
    }
    renderAll();
   };
   d.appendChild(blk);
   doses.appendChild(d);
  });

  const btn=document.createElement("button");
  btn.className="secondary block-btn";
  btn.textContent=s.bd?"Unblock":"Block";
  btn.onclick=()=>{
   s.bd=!s.bd;
   if(s.bd){
    s.c=null;
    s.b=new Set(drug.d);
   } else s.b.clear();
   renderAll();
  };

  row.appendChild(name);
  row.appendChild(doses);
  row.appendChild(btn);
  box.appendChild(row);
 });
}

function renderAll(){
 renderSection("A");
 renderSection("C");
 renderSection("D");
 renderSection("O");
}

renderAll();
</script>

</body>
</html>
