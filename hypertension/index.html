<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Hypertension management assistant</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="../shared/styles.css">
<style>
main{max-width:960px;margin:1.5rem auto;padding:1rem;background:#fff;border-radius:4px;box-shadow:0 2px 6px rgba(0,0,0,.1)}
.drug-list{max-height:360px;overflow:auto;border:1px solid var(--nhs-border);border-radius:4px;background:#fff;padding:.4rem}
.drug-row{display:grid;grid-template-columns:1.6fr 1fr auto auto;gap:.45rem;align-items:center;padding:.35rem 0;border-bottom:1px solid #eee;font-size:.9rem}
.badge{font-weight:bold;font-size:.75rem;padding:2px 6px;border-radius:4px;min-width:22px;text-align:center}
.badge.a{background:#e8f4ff}
.badge.c{background:#eef9f1;color:#005a30}
.badge.d{background:#fff4e5;color:#7a4a00}
.badge.o{background:#f0f4f5;color:#425563}
.alert{border-radius:4px;padding:.6rem;margin-bottom:.6rem;font-size:.9rem}
.alert.info{background:#e8f4ff;border:1px solid #0072ce}
.alert.warn{background:#fdecea;border:1px solid #d4351c}
.flag-add{color:#00703c;font-weight:bold}
.flag-titrate{color:#6f4c00;font-weight:bold}
textarea{width:100%;min-height:7rem;font-family:inherit;font-size:.9rem}
.top-actions{display:flex;gap:.5rem;margin-bottom:.75rem}
</style>
</head>

<body>
<header>
  <h1>Hypertension management assistant</h1>
  <p class="subtitle">NICE NG136 & BIHS aligned decision aid</p>
  <a href="../index.html" class="return-home">Back to home</a>
</header>

<main>

<section class="card">
<h2>1. Patient context</h2>
<div class="grid">
  <div>
    <label>Age band</label>
    <select id="ageBand">
      <option value="18-39">18–39</option>
      <option value="40-54">40–54</option>
      <option value="55-79" selected>55–79</option>
      <option value="80+">80+</option>
    </select>
  </div>
  <div>
    <label>Ethnicity</label>
    <select id="ethnicity">
      <option value="other">White / Other</option>
      <option value="black">Black African or Caribbean</option>
    </select>
  </div>
</div>
</section>

<section class="card">
<h2>2. Current antihypertensive treatment</h2>
<p>Select drugs and doses. Block excludes drug from recommendations.</p>
<div class="drug-list" id="drugList"></div>
</section>

<section class="card">
<h2>3. Blood pressure</h2>
<div class="grid">
  <div>
    <label>Measurement</label>
    <select id="bpType">
      <option value="clinic">Clinic</option>
      <option value="home">Home / ABPM</option>
    </select>
  </div>
  <div>
    <label>BP</label>
    <input id="bpValue" placeholder="e.g. 152/94">
  </div>
</div>
</section>

<section class="card">
<h2>4. Outputs</h2>

<div class="top-actions">
  <button id="genBtn">Generate plan</button>
  <button class="secondary" id="clearBtn">Clear</button>
</div>

<div id="alerts"></div>

<strong>Medication plan</strong>
<div class="output-box" id="medPlan"></div>

<div style="margin-top:.75rem">
<strong>Clinician note</strong>
<button class="copy-btn" id="copyClin">Copy</button>
<textarea id="clinician" readonly></textarea>
</div>

<div style="margin-top:.75rem">
<strong>Patient information</strong>
<button class="copy-btn" id="copyPt">Copy</button>
<textarea id="patient" readonly></textarea>
</div>

</section>

</main>

<footer>NICE NG136 • Decision support only</footer>

<script>
const DRUGS=[
 {name:"Ramipril",cat:"A",doses:["1.25 mg","2.5 mg","5 mg","10 mg"]},
 {name:"Losartan",cat:"A",doses:["25 mg","50 mg","100 mg"]},
 {name:"Amlodipine",cat:"C",doses:["2.5 mg","5 mg","10 mg"]},
 {name:"Indapamide MR",cat:"D",doses:["1.5 mg"]},
 {name:"Chlortalidone",cat:"D",doses:["12.5 mg","25 mg"]},
 {name:"Spironolactone",cat:"O",doses:["12.5 mg","25 mg"]}
];

function el(id){return document.getElementById(id);}

function renderDrugs(){
 const list=el("drugList");
 list.innerHTML="";
 DRUGS.forEach((d,i)=>{
   const row=document.createElement("div");
   row.className="drug-row";
   row.innerHTML=`
    <label><input type="checkbox" class="use" data-i="${i}"> ${d.name}</label>
    <select class="dose">${d.doses.map(x=>`<option>${x}</option>`).join("")}</select>
    <span class="badge ${d.cat.toLowerCase()}">${d.cat}</span>
    <label><input type="checkbox" class="block" data-i="${i}"> Block</label>`;
   list.appendChild(row);
 });
}

function parseBP(){
 const m=el("bpValue").value.match(/(\d+)(?:\/(\d+))?/);
 if(!m) return null;
 return {sys:parseInt(m[1]),dia:m[2]?parseInt(m[2]):null};
}

function calculate(){
 const bp=parseBP();
 if(!bp){
   el("alerts").innerHTML='<div class="alert warn">Enter a valid BP</div>';
   return;
 }
 const current=[];
 document.querySelectorAll(".drug-row").forEach((r,i)=>{
   const use=r.querySelector(".use").checked;
   const block=r.querySelector(".block").checked;
   if(use && !block){
     current.push(DRUGS[i].name+" "+r.querySelector(".dose").value);
   }
 });

 el("alerts").innerHTML='<div class="alert info">Plan generated</div>';
 el("medPlan").innerHTML =
   current.length
   ? `<span class="flag-titrate">Review current therapy:</span><br>`+current.join("<br>")
   : `<span class="flag-add">ADD:</span> Start antihypertensive per NICE step 1.`;

 el("clinician").value =
   "Hypertension review. BP "+bp.sys+(bp.dia?"/"+bp.dia:"")+".\nCurrent meds: "+(current.join(", ")||"none")+".";

 el("patient").value =
   "Your blood pressure has been reviewed.\n"+
   (current.length
     ? "We will review your current tablets."
     : "We are starting a new blood pressure tablet in addition to any you already take.");
}

renderDrugs();
el("genBtn").onclick=calculate;
el("clearBtn").onclick=()=>location.reload();
el("copyClin").onclick=()=>navigator.clipboard.writeText(el("clinician").value);
el("copyPt").onclick=()=>navigator.clipboard.writeText(el("patient").value);
</script>

</body>
</html>
