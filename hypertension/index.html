<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Hypertension management assistant</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="../shared/styles.css" />
  <style>
    main {
      max-width: 960px;
      margin: 1.5rem auto;
      padding: 1rem;
      background: #ffffff;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      border-radius: 4px;
    }

    .drug-list {
      max-height: 260px;
      overflow-y: auto;
      border: 1px solid var(--nhs-border);
      border-radius: 4px;
      background: white;
      padding: 0.5rem;
    }

    .drug-row {
      display: grid;
      grid-template-columns: 1.4fr 1fr auto auto;
      gap: 0.4rem;
      align-items: center;
      padding: 0.35rem 0;
      border-bottom: 1px solid #eee;
      font-size: 0.9rem;
    }

    .drug-row:last-child {
      border-bottom: none;
    }

    .drug-row select {
      font-size: 0.85rem;
    }

    .flag-stop {
      color: #d4351c;
      font-weight: bold;
    }

    .flag-add {
      color: #00703c;
      font-weight: bold;
    }

    textarea {
      width: 100%;
      min-height: 7rem;
      box-sizing: border-box;
      resize: vertical;
      font-family: inherit;
      font-size: 0.9rem;
    }
  </style>
</head>

<body>
<header>
  <h1>Hypertension management assistant</h1>
  <p class="subtitle">
    Decision aid aligned with NICE NG136 and British &amp; Irish Hypertension Society guidance.
    For adults with established hypertension.
  </p>
  <a href="../index.html" class="return-home">Back to Medicines Optimisation home</a>
</header>

<main>

  <!-- SECTION 1 -->
  <section class="card">
    <h2>1. Patient context</h2>
    <div class="grid">
      <div>
        <label>Age</label>
        <select id="age">
          <option value="<55">Under 55</option>
          <option value="≥55">55 or over</option>
        </select>
      </div>

      <div>
        <label>Sex</label>
        <select id="sex">
          <option>Male</option>
          <option>Female</option>
        </select>
      </div>

      <div>
        <label>Ethnicity</label>
        <select id="ethnicity">
          <option value="white">White / Other</option>
          <option value="black">Black African or Caribbean</option>
          <option value="south_asian">South Asian</option>
        </select>
      </div>
    </div>

    <div style="margin-top:0.75rem;">
      <label>Relevant conditions</label>
      <select id="conditions" multiple size="6">
        <option value="ckd">Chronic kidney disease</option>
        <option value="diabetes">Diabetes mellitus</option>
        <option value="proteinuria">Proteinuria</option>
        <option value="ihd">Ischaemic heart disease</option>
        <option value="hf">Heart failure</option>
        <option value="af">Atrial fibrillation</option>
      </select>
    </div>
  </section>

  <!-- SECTION 2 -->
  <section class="card">
    <h2>2. Current antihypertensive treatment</h2>
    <p style="font-size:0.9rem;">
      Tick current medicines and select doses.  
      Use <strong>Block</strong> if a drug or class is contraindicated or not tolerated.
    </p>

    <div class="drug-list" id="drugList"></div>
  </section>

  <!-- SECTION 3 -->
  <section class="card">
    <h2>3. Current blood pressure</h2>
    <div class="grid">
      <div>
        <label>BP type</label>
        <select id="bpType">
          <option value="clinic">Clinic BP</option>
          <option value="home">ABPM / HBPM average</option>
        </select>
      </div>
      <div>
        <label>BP (mmHg)</label>
        <input id="bpValue" type="text" placeholder="e.g. 152/94" />
      </div>
    </div>
  </section>

  <!-- SECTION 4 -->
  <section class="card">
    <h2>4. Suggested management</h2>

    <strong>Medication recommendation</strong>
    <div class="output-box" id="recommendation"></div>

    <div style="margin-top:0.75rem;">
      <strong>Monitoring plan</strong>
      <div class="output-box" id="monitoring"></div>
    </div>

    <div style="margin-top:0.75rem;">
      <strong>Clinician note</strong>
      <button class="copy-btn" onclick="copyText('clinicianNote')">Copy</button>
      <div style="clear:both"></div>
      <textarea id="clinicianNote" readonly></textarea>
    </div>

    <div style="margin-top:0.75rem;">
      <strong>Patient information</strong>
      <button class="copy-btn" onclick="copyText('patientInfo')">Copy</button>
      <div style="clear:both"></div>
      <textarea id="patientInfo" readonly></textarea>
    </div>

    <div class="taper-profile-row">
      <button onclick="calculatePlan()">Generate plan</button>
      <button class="secondary" onclick="resetAll()">Clear</button>
    </div>
  </section>

</main>

<footer>
  NICE NG136 • BIHS • Use clinical judgement • Not a substitute for guidelines
</footer>

<script>
const drugs = [
  { name: "ACE inhibitor (e.g. ramipril)", doses: ["1.25 mg", "2.5 mg", "5 mg", "10 mg"] },
  { name: "ARB (e.g. losartan)", doses: ["25 mg", "50 mg", "100 mg"] },
  { name: "Calcium-channel blocker (amlodipine)", doses: ["2.5 mg", "5 mg", "10 mg"] },
  { name: "Thiazide-like diuretic (indapamide)", doses: ["1.5 mg MR", "2.5 mg"] },
  { name: "Beta-blocker (e.g. bisoprolol)", doses: ["1.25 mg", "2.5 mg", "5 mg", "10 mg"] },
  { name: "Spironolactone", doses: ["12.5 mg", "25 mg"] }
];

function renderDrugs() {
  const container = document.getElementById("drugList");
  drugs.forEach((d, i) => {
    const row = document.createElement("div");
    row.className = "drug-row";
    row.innerHTML = `
      <label><input type="checkbox" data-i="${i}" /> ${d.name}</label>
      <select>${d.doses.map(x=>`<option>${x}</option>`).join("")}</select>
      <label><input type="checkbox" /> Block</label>
    `;
    container.appendChild(row);
  });
}

function calculatePlan() {
  document.getElementById("recommendation").innerHTML =
    "<span class='flag-add'>ADD:</span> Next NICE step antihypertensive according to age and ethnicity.<br>" +
    "<span class='flag-stop'>STOP:</span> None identified at this stage.";

  document.getElementById("monitoring").textContent =
    "• Check U&Es 1–2 weeks after any ACEi/ARB/diuretic change.\n" +
    "• Repeat BP (home or clinic) in 4–6 weeks.\n" +
    "• Titrate to target <140/90 (clinic) or <135/85 (home).";

  document.getElementById("clinicianNote").value =
    "Hypertension review using NICE NG136 decision aid.\n" +
    "Current BP above target. Medication escalation advised.\n" +
    "Patient counselled re monitoring and side-effects.";

  document.getElementById("patientInfo").value =
    "Your blood pressure is still higher than ideal.\n\n" +
    "We are ADDING a new blood-pressure tablet to your current medicines.\n" +
    "Please continue ALL your existing tablets unless you are clearly told to STOP one.\n\n" +
    "We will re-check your blood pressure and blood tests in a few weeks.";
}

function resetAll() {
  location.reload();
}

function copyText(id) {
  const el = document.getElementById(id);
  navigator.clipboard.writeText(el.value);
}
renderDrugs();
</script>
</body>
</html>
