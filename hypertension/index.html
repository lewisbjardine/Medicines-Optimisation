<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Hypertension – medication picker</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="../shared/styles.css">
<style>
main{max-width:1000px;margin:1.5rem auto;padding:1rem;background:#fff;border-radius:6px;box-shadow:0 2px 6px rgba(0,0,0,.1)}
.matrix{border:1px solid var(--nhs-border);border-radius:4px;overflow:hidden}
.row{display:grid;grid-template-columns:220px 1fr 140px;gap:.5rem;padding:.6rem;border-bottom:1px solid #eee;align-items:center}
.row:last-child{border-bottom:none}
.doses{display:flex;flex-wrap:wrap;gap:.4rem}
.dose{display:flex;align-items:center;gap:.25rem;padding:.15rem .4rem;border-radius:4px;border:1px solid var(--nhs-border);cursor:pointer;font-size:.85rem}
.dose.current{background:#e8f4ff;border-color:#0072ce;font-weight:bold}
.dose.blocked{opacity:.4;text-decoration:line-through}
.block-dose{font-size:.8rem;color:#d4351c;cursor:pointer}
.block-btn{font-size:.8rem}
.section{margin-top:1.5rem}
textarea{width:100%;min-height:6rem}
</style>
</head>
<body>

<header>
  <h1>Hypertension management assistant</h1>
  <p class="subtitle">Medication selection & dose tolerance</p>
  <a href="../index.html" class="return-home">Back to home</a>
</header>

<main>

<section class="card">
<h2>1. Current antihypertensive treatment</h2>
<p>Select the <strong>current dose</strong>. Use ⛔ to block doses not tolerated.</p>

<div class="matrix" id="matrix"></div>
</section>

<section class="card section">
<h2>2. Current blood pressure</h2>
<div class="grid">
  <div>
    <label>Measurement type</label>
    <select id="bpType">
      <option value="clinic">Clinic BP</option>
      <option value="home">Home / ABPM</option>
    </select>
  </div>
  <div>
    <label>BP</label>
    <input id="bpValue" placeholder="e.g. 152/94">
  </div>
</div>
</section>

<section class="card section">
<h2>3. Plan output (preview)</h2>
<p class="hint">This will contain NICE-guided recommendations once logic is reattached.</p>
<button id="genBtn">Generate plan (preview)</button>
<div class="output-box" id="planBox"></div>
</section>

</main>

<script>
(function(){
const DRUGS = [
  { name:"Amlodipine", doses:["2.5","5","10"] },
  { name:"Felodipine MR", doses:["2.5","5","10"] },
  { name:"Lercanidipine", doses:["10","20"] },
  { name:"Ramipril", doses:["1.25","2.5","5","10"] },
  { name:"Lisinopril", doses:["2.5","5","10","20","40"] },
  { name:"Perindopril", doses:["2","4","8"] },
  { name:"Losartan", doses:["25","50","100"] },
  { name:"Candesartan", doses:["2","4","8","16","32"] },
  { name:"Irbesartan", doses:["75","150","300"] },
  { name:"Indapamide MR", doses:["1.5"] },
  { name:"Chlortalidone", doses:["12.5","25"] },
  { name:"Spironolactone", doses:["12.5","25"] },
  { name:"Doxazosin MR", doses:["4","8"] },
  { name:"Bisoprolol", doses:["1.25","2.5","5","10"] }
];

const state = {};
const matrix = document.getElementById("matrix");

function init(drug){
  if(!state[drug.name]){
    state[drug.name]={current:null,blocked:new Set(),blockDrug:false};
  }
}

function render(){
  matrix.innerHTML="";
  DRUGS.forEach(drug=>{
    init(drug);
    const s=state[drug.name];
    const row=document.createElement("div");
    row.className="row";

    const name=document.createElement("strong");
    name.textContent=drug.name;

    const doses=document.createElement("div");
    doses.className="doses";

    drug.doses.forEach(d=>{
      const wrap=document.createElement("div");
      wrap.className="dose";
      if(s.current===d) wrap.classList.add("current");
      if(s.blocked.has(d)) wrap.classList.add("blocked");

      const lbl=document.createElement("span");
      lbl.textContent=d+" mg";

      const block=document.createElement("span");
      block.className="block-dose";
      block.textContent="⛔";
      block.title="Block / unblock this dose";

      wrap.onclick=()=>{
        if(s.blocked.has(d)) return;
        s.current = (s.current===d) ? null : d;
        render();
      };

      block.onclick=(e)=>{
        e.stopPropagation();
        if(s.blocked.has(d)) s.blocked.delete(d);
        else{
          s.blocked.add(d);
          if(s.current===d) s.current=null;
        }
        render();
      };

      wrap.appendChild(lbl);
      wrap.appendChild(block);
      doses.appendChild(wrap);
    });

    const btn=document.createElement("button");
    btn.className="secondary block-btn";
    btn.textContent=s.blockDrug?"Unblock drug":"Block drug";
    btn.onclick=()=>{
      s.blockDrug=!s.blockDrug;
      if(s.blockDrug){
        s.current=null;
        s.blocked=new Set(drug.doses);
      } else {
        s.blocked.clear();
      }
      render();
    };

    row.appendChild(name);
    row.appendChild(doses);
    row.appendChild(btn);
    matrix.appendChild(row);
  });
}

document.getElementById("genBtn").onclick=()=>{
  document.getElementById("planBox").textContent=
    "Preview only:\n• BP entered: "+(document.getElementById("bpValue").value||"not entered")+
    "\n• Medication state captured successfully.";
};

render();
})();</script>

</body>
</html>